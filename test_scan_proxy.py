#!/usr/bin/env python3"""Test script for /chat/scan-grocery-proxy endpointDemonstrates iOS Safari-compatible multipart form data upload"""import requestsfrom pathlib import Path# ConfigurationAPI_BASE_URL = "http://localhost:8000"  # Change for production# API_BASE_URL = "https://freshlybackend.duckdns.org"# You'll need a valid JWT token - get one by logging inJWT_TOKEN = "your_jwt_token_here"def test_scan_grocery_proxy_with_file(image_path: str):    """Test the scan-grocery-proxy endpoint with an actual image file"""        print("=" * 70)    print("TESTING /chat/scan-grocery-proxy ENDPOINT")    print("=" * 70)    print()        image_file = Path(image_path)        if not image_file.exists():        print(f"‚ùå ERROR: Image file not found: {image_path}")        print("Please provide a valid image file path")        return        print(f"üì∏ Image file: {image_file.name}")    print(f"   Size: {image_file.stat().st_size / 1024:.2f} KB")    print()        # Prepare the request    with open(image_file, 'rb') as f:        files = {            'file': (image_file.name, f, 'image/jpeg')        }        data = {            'scan_type': 'groceries'  # or 'receipt'        }        headers = {            'Authorization': f'Bearer {JWT_TOKEN}'        }                print("üöÄ Sending request...")        response = requests.post(            f"{API_BASE_URL}/chat/scan-grocery-proxy",            files=files,            data=data,            headers=headers        )        print(f"üìä Status Code: {response.status_code}")    print()        if response.status_code == 200:        result = response.json()        print("‚úÖ SUCCESS!")        print()        print(f"üì¶ Total Items: {result.get('total_items', 0)}")        print(f"üí¨ Conversation ID: {result.get('conversation_id')}")        print(f"üìù Message ID: {result.get('message_id')}")        print()        print("üõí Items Found:")        for i, item in enumerate(result.get('items', []), 1):            print(f"   {i}. {item['name']}")            print(f"      Quantity: {item['quantity']}")            print(f"      Category: {item['category']}")            print(f"      Confidence: {item['confidence']:.2f}")            print()                if result.get('analysis_notes'):            print(f"üìã Notes: {result['analysis_notes']}")                else:        print(f"‚ùå FAILED: {response.status_code}")        try:            error = response.json()            print(f"   Error: {error.get('detail', response.text)}")        except:            print(f"   Response: {response.text}")def print_curl_example():    """Print curl command example"""    print()    print("=" * 70)    print("CURL EXAMPLE FOR iOS SAFARI / MOBILE")    print("=" * 70)    print()    print("curl -X POST 'http://localhost:8000/chat/scan-grocery-proxy' \\")    print("  -H 'Authorization: Bearer YOUR_JWT_TOKEN' \\")    print("  -F 'file=@/path/to/your/grocery_image.jpg' \\")    print("  -F 'scan_type=groceries'")    print()    print("For receipts, use:")    print("  -F 'scan_type=receipt'")    print()    print("With conversation ID:")    print("  -F 'conversation_id=123'")    print()def print_javascript_example():    """Print JavaScript fetch example for iOS Safari"""    print()    print("=" * 70)    print("JAVASCRIPT EXAMPLE FOR iOS SAFARI")    print("=" * 70)    print()    print("""// iOS Safari-compatible image uploadconst formData = new FormData();formData.append('file', imageFile); // File from <input type="file">formData.append('scan_type', 'groceries'); // or 'receipt'// formData.append('conversation_id', '123'); // optionalconst response = await fetch('http://localhost:8000/chat/scan-grocery-proxy', {  method: 'POST',  headers: {    'Authorization': `Bearer ${jwtToken}`  },  body: formData // No Content-Type header - browser sets it automatically});const result = await response.json();console.log('Items found:', result.items);console.log('Total:', result.total_items);""")if __name__ == "__main__":    import sys        print()        if JWT_TOKEN == "your_jwt_token_here":        print("‚ö†Ô∏è  WARNING: JWT_TOKEN not set!")        print("   Update the JWT_TOKEN variable with a valid token.")        print()        print("   Get a token by logging in:")        print("   POST /auth/login with your credentials")        print()        if len(sys.argv) > 1:        # Test with provided image file        image_path = sys.argv[1]        test_scan_grocery_proxy_with_file(image_path)    else:        print("Usage: python test_scan_proxy.py <path_to_image.jpg>")        print()        print("Example:")        print("  python test_scan_proxy.py ~/Downloads/groceries.jpg")        print()        print_curl_example()    print_javascript_example()        print()    print("=" * 70)    print("ENDPOINT BENEFITS")    print("=" * 70)    print()    print("‚úÖ iOS Safari compatible (no base64 JSON issues)")    print("‚úÖ Direct file upload from mobile devices")    print("‚úÖ Same AI processing as /scan-grocery")    print("‚úÖ Same response format (items, total_items, etc.)")    print("‚úÖ 2MB file size limit for reliability")    print("‚úÖ Supports both groceries and receipts")    print()